<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor Slot Booking</title>
    <link rel="icon" href="logoHC.jpeg" type="image/x-icon" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 20px;
        background: white;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
      }

      h1 {
        font-size: 28px;
        color: #333;
        text-align: center;
        margin-bottom: 20px;
      }

      .dropdown {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 20px;
        font-size: 16px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      table th,
      table td {
        border: 1px solid #ddd;
        padding: 15px;
        text-align: center;
      }

      table th {
        background-color: #f4f4f4;
        font-weight: bold;
        color: #555;
      }

      table tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      .button-book,
      .button-cancel {
        padding: 10px 20px;
        font-size: 14px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .button-book {
        background-color: #4caf50;
        color: white;
        margin-right: 10px;
      }

      .button-book:hover {
        background-color: #45a049;
      }

      .button-cancel {
        background-color: #e53935;
        color: white;
      }

      .button-cancel:hover {
        background-color: #d32f2f;
      }

      .doctor-info {
        margin: 20px 0;
      }

      .doctor-info h2 {
        margin: 5px 0;
        color: #333;
      }

      .doctor-info p {
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Doctor Slot Booking</h1>
      <select class="dropdown" id="doctorSelect" onchange="changeDoctor()">
        <% doctors.forEach((doctor, index) => { %>
        <option value="<%= index %>">
          <%= doctor.first_name %> <%= doctor.last_name %> - <%= doctor.dept %>
        </option>
        <% }); %>
      </select>

      <div id="doctorContent">
        <% if (doctors && doctors.length > 0) { %>
        <div class="doctor-info">
          <h2><%= doctors[0].first_name %> <%= doctors[0].last_name %></h2>
          <p>Department: <%= doctors[0].dept %></p>
        </div>
        <% } else { %>
        <p>No doctors available at the moment.</p>
        <% } %>
      </div>

      <table>
        <thead>
          <tr>
            <th>Available Time Slots</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% if (doctors.length > 0) {
          Object.keys(doctors[0].appointments).forEach(time => { %>
          <tr>
            <td><%= time %></td>
            <td>
              <% if (person.username && doctors[0].appointments[time] ===
              person.username) { %>
              <form action="/cancelSlot" method="POST">
                <input
                  type="hidden"
                  name="doctorName"
                  value="<%= doctors[0].first_name %>"
                />
                <input type="hidden" name="slotTime" value="<%= time %>" />
                <button type="submit" class="button-cancel">Cancel Slot</button>
              </form>
              <% } else if (doctors[0].appointments[time] === "") { %>
<<<<<<< HEAD
              <div style="display: flex; gap: 10px">
                <form action="/bookDirectSlot" method="POST">
                  <input
                    type="hidden"
                    name="doctorName"
                    value="<%= doctors[0].first_name %>"
                  />
                  <input type="hidden" name="slotTime" value="<%= time %>" />
                  <input
                    type="hidden"
                    name="userName"
                    value="<%= person.username %>"
                  />
                  <button type="submit" class="button-book">
                    Direct Visit
                  </button>
                </form>
                <form action="/bookVirtualSlot" method="POST">
                  <input
                    type="hidden"
                    name="doctorName"
                    value="<%= doctors[0].first_name %>"
                  />
                  <input type="hidden" name="slotTime" value="<%= time %>" />
                  <input
                    type="hidden"
                    name="userName"
                    value="<%= person.username %>"
                  />
                  <input
                    type="hidden"
                    name="userPassword"
                    value="<%= person.password %>"
                  />
                  <button type="submit" class="button-book">
                    Virtual Meet
                  </button>
                </form>
              </div>
=======
              <form action="/bookDirectSlot" method="POST">
                <input
                  type="hidden"
                  name="doctorName"
                  value="<%= doctors[0].first_name %>"
                />
                <input type="hidden" name="slotTime" value="<%= time %>" />
                <input
                  type="hidden"
                  name="userName"
                  value="<%= loggedInUser.username %>"
                />
                <button type="submit" class="button-book">Direct Visit</button>
              </form>
>>>>>>> 501e8bed2e0a00de24fc53fe9684effe0ec05d32
              <% } else { %>
              <span>Booked</span>
              <% } %>
            </td>
          </tr>
          <% }); } else { %>
          <tr>
            <td colspan="2">No slots available.</td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
<<<<<<< HEAD

    <%- include('footer') %>

    <script>
      function changeDoctor() {
        const doctorIndex = parseInt(
          document.getElementById("doctorSelect").value,
          10
        );
        const doctor = doctors[doctorIndex];
        const doctorContent = document.getElementById("doctorContent");

        doctorContent.innerHTML = `
          <div class="doctor-info">
            <h2>${doctor.first_name} ${doctor.last_name}</h2>
            <p>${doctor.dept}</p>
          </div>
          <div class="table-container">
            <table>
              <tr>
                <th>Available Time Slots</th>
                <th>Action</th>
              </tr>
              ${Object.keys(doctor.appointments)
                .map(
                  (time) => `
                <tr>
                  <td>${time}</td>
                  <td>
                    ${
                      person.username &&
                      doctor.appointments[time] === person.username
                        ? `<form action="/cancelSlot" method="POST">
                            <input type="hidden" name="doctorName" value="${doctor.first_name}" />
                            <input type="hidden" name="slotTime" value="${time}" />
                            <button type="submit" class="button-cancel">Cancel Slot</button>
                          </form>`
                        : doctor.appointments[time] === ""
                        ? `<div style="display: flex; gap: 10px;">
                            <form action="/bookDirectSlot" method="POST">
                              <input type="hidden" name="doctorName" value="${doctor.first_name}" />
                              <input type="hidden" name="slotTime" value="${time}" />
                              <input type="hidden" name="userName" value="${loggedInUser.username}" />
                              <button type="submit" class="button-book">Direct Visit</button>
                            </form>
                            <form action="/bookVirtualSlot" method="POST">
                              <input type="hidden" name="doctorName" value="${doctor.first_name}" />
                              <input type="hidden" name="slotTime" value="${time}" />
                              <input type="hidden" name="userName" value="${loggedInUser.username}" />
                              <input type="hidden" name="userPassword" value="${loggedInUser.password}" />
                              <button type="submit" class="button-book">Virtual Meet</button>
                            </form>
                          </div>`
                        : `<span>Booked</span>`
                    }
                  </td>
                </tr>
              `
                )
                .join("")}
            </table>
          </div>
        `;
      }
    </script>
=======
>>>>>>> 501e8bed2e0a00de24fc53fe9684effe0ec05d32
  </body>
</html>
