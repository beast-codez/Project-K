<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Available Medicines</title>
  <link rel="icon" href="logoHC.jpeg" type="image/x-icon">

  <script src="https://kit.fontawesome.com/d70dca505b.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      overflow-x: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
    }

    .main-content {
      flex-grow: 1;
      margin: 20px auto;
      padding: 0 20px;
      width: 90%;
    }

    .search-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .search-bar input[type="text"] {
      padding: 10px;
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .search-bar select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-left: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .header h1 {
      margin: 0;
    }

    .dropdown {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .table-container {
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: white;
      padding: 10px;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 auto;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f4f4f4;
    }

    tbody tr:nth-child(odd) {
      background-color: #f9f9f9;
    }

    tbody tr:nth-child(even) {
      background-color: #f1f1f1;
    }

    .button-cancel {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }

    .button-book {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <%- include('navbarfin') %>
  <div>
    <img src="image.png" alt="Information" width="100%">
  </div>
  <br><br>
  <div class="container main-content">
    <div class="header">
      <h1>Doctor Slot Booking</h1>
      <select class="dropdown" id="doctorSelect" onchange="changeDoctor()">
        <% doctors.forEach((doctor, index) => { %>
          <option value="<%= index %>"><%= doctor.first_name %> <%= doctor.last_name %> - <%= doctor.dept %></option>
        <% }); %>
      </select>
    </div>

    <div id="doctorContent">
      <% if (doctors && doctors.length > 0) { %>
        <div class="doctor-info">
          <h2><%= doctors[0].first_name %> <%= doctors[0].last_name %></h2>
          <p><%= doctors[0].dept %></p>
        </div>
      <% } else { %>
        <p>No doctors available at the moment.</p>
      <% } %>
    </div>

    <div class="table-container">
      <table>
        <tr>
          <th>Available Time Slots</th>
          <th>Action</th>
        </tr>
        <% Object.keys(doctors[0].appointments).forEach(time => { %>
          <tr>
            <td><%= time %></td>
            <td>
              <% if (loggedInUser.username && doctors[0].appointments[time] === loggedInUser.username) { %>
                <form action="/cancelSlot" method="POST">
                  <input type="hidden" name="doctorName" value="<%= doctors[0].first_name %>">
                  <input type="hidden" name="slotTime" value="<%= time %>">
                  <button type="submit" class="button-cancel">Cancel Slot</button>
                </form>
              <% } else if (doctors[0].appointments[time] === "") { %>
                <form action="/bookslot" method="POST">
                  <input type="hidden" name="doctorName" value="<%= doctors[0].first_name %>">
                  <input type="hidden" name="slotTime" value="<%= time %>">
                  <input type="hidden" name="userName" value="<%= loggedInUser.username %>">
                  <button type="submit" class="button-book">Book Now</button>
                </form>
              <% } else { %>
                <span>Booked</span>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </table>
    </div>
  </div>

  <%-include('footer')%>

  <script>
    const doctors = <%- JSON.stringify(doctors) %>;

    function changeDoctor() {
      const doctorIndex = parseInt(document.getElementById('doctorSelect').value);
      const doctor = doctors[doctorIndex];
      const doctorContent = document.getElementById('doctorContent');

      doctorContent.innerHTML = `
        <div class="doctor-info">
          <h2>${doctor.first_name} ${doctor.last_name}</h2>
          <p>${doctor.dept}</p>
        </div>
        <div class="table-container">
          <table>
            <tr>
              <th>Available Time Slots</th>
              <th>Action</th>
            </tr>
            ${Object.keys(doctor.appointments).map(time => `
              <tr>
                <td>${time}</td>
                <td>
                  ${loggedInUser.username && doctor.appointments[time] === loggedInUser.username ? `
                    <form action="/cancelSlot" method="POST">
                      <input type="hidden" name="doctorName" value="${doctor.first_name}">
                      <input type="hidden" name="slotTime" value="${time}">
                      <button type="submit" class="button-cancel">Cancel Slot</button>
                    </form>
                  ` : doctor.appointments[time] === "" ? `
                    <form action="/bookslot" method="POST">
                      <input type="hidden" name="doctorName" value="${doctor.first_name}">
                      <input type="hidden" name="slotTime" value="${time}">
                      <input type="hidden" name="userName" value="${loggedInUser.username}">
                      <button type="submit" class="button-book">Book Now</button>
                    </form>
                  ` : `
                    <span>Booked</span>
                  `}
                </td>
              </tr>
            `).join('')}
          </table>
        </div>
      `;
    }
  </script>
</body>
</html>
